Урок 72. Preferences. Список, экраны и категории
23 апреля 2012
В этом уроке:
- используем в настройках список  - группируем настройки по экранам и категориям

На прошлом уроке мы узнали, как несложно создается экран настроек, и использовали там чекбокс и поле для ввода. Немного расширим наши знания и используем новые компоненты:
список (ListPreference) – позволяет выбрать значение из нескольких возможных
экран (PreferenceScreen) – с его помощью можно делать вложенные экраны с настройками
категория (PreferenceCategory) – группировка нескольких настроек

Создадим простое приложение. На первом экране будем читать и отображать значение из настройки-списка. Второй экран будет отображать все настройки.

Создадим проект:
Project name: P0721_PreferencesSimple2 Build Target: Android 2.3.3 Application name: PreferencesSimple2 Package name: ru.startandroid.develop.p0721preferencessimple2 Create Activity: MainActivity

Заполним strings.xml:
Мы создали два массива, чуть позже их используем для списка значений.

Рисуем основной экран main.xml:
Здесь только текстовое поле.

Создадим xml-файл с настройками res/xml/pref.xml:

Создавать его, конечно, можно не только через xml, но и конструктором. Вот такая получается картинка:

У нас в настройках будет чекбокс (chb), список (list) и вложенный экран (screen). Внутри screen две категории (categ 1 и categ2), а в них просто чекбоксы. Все просто и понятно.
Из интересного стоит отметить аттрибуты entries и entryValues у ListPreference. entries – это то, что отобразит список пользователю, а entryValues – это то, что сохранит система после выбора значения в списке. Мы используем тут два разных массива. В итоге список покажет значения one, two, three, а сохранит соответственно 1,2 или 3. Можно использовать один массив в обоих атрибутах, тогда отображаемые и сохраняемые значения будут равны.

Создаем Activity для настроек – PrefActivity.java:

И MainActivity.java:

В onCreate получаем доступ к настройкам.
В onResume выводим в tvInfo значение из настроек, которое записал туда список. Если значений нет, то пишем текст «не выбрано»
В onCreateOptionsMenu создаем пункт меню и вешаем на него Intent, который запустит нам экран настроек.
Остальные параметры читать не буду, это мы на прошлом уроке рассмотрели, там все просто.

Все сохраним и запустим.

Изначально настройки пусты, в списке ничего не было выбрано.
Переходим через меню на экран настроек.

Первый пункт – чекбокс, второй – список, третий – вложенный экран.
Нажмем на список:

Показаны значения из списка entries. Выбираем устраивающее нас значение, список закрывается и сохраняется соответствующее значение из списка entry_values. Можно вернуться на первый экран кнопкой Назад (Back) и убедиться в этом.

Я выбрал two, сохранилось 2.
Снова идем в экран настроек и жмем на вложенный экран Screen. Провалились внутрь.

Тут куча чекбоксов, которые сгруппированы по двум категориям.

Теперь мы умеем создавать экраны настроек с группировкой элементов по категориям и подэкранам. Это значительно удобнее для пользователя, чем куча разных настроек на одном экране.

На следующем уроке:
- управляем активностью настроек (setEnabled)
Присоединяйтесь к нам в Telegram:
- в канале StartAndroid публикуются ссылки на новые статьи с сайта startandroid.ru и интересные материалы с хабра, medium.com и т.п.
- в чатах решаем возникающие вопросы и проблемы по различным темам: Android, Compose, Kotlin, RxJava, Dagger, Тестирование, Performance
- ну и если просто хочется поговорить с коллегами по разработке, то есть чат Флудильня
