Урок 63. Диалоги. AlertDialog. Список с одиночным выбором
08 марта 2012
В этом уроке:
- формируем список с одиночным выбором в диалоге

Урок будет аналогичен прошлому, только теперь мы не будем обновлять данные списка диалога.
Мы будем формировать в диалоге список с одиночным выбором и определять какой элемент был выбран (чекнут).

Создадим проект:
Project name: P0631_AlertDialogItemsSingle Build Target: Android 2.3.3 Application name: AlertDialogItemsSingle Package name: ru.startandroid.develop.p0631alertdialogitemssingle Create Activity: MainActivity

В strings.xml пропишем тексты:

main.xml, три кнопки:

DB.java аналогичен с прошлого урока, только уберем метод изменения записей

MainActivity.java немного изменился:
В onCreate подключаемся к базе.

onclick – в зависимости от нажатой кнопки вызываем соответствующий диалог.

onCreateDialog – создаем вызываемый диалог, используя AlertDialog.Builder. Диалог может построить список, используя один из следующих объектов:
1) Массив строк. Используется метод setSingleChoiceItems. На вход подается массив, позиция выбранного элемента и обработчик нажатия.  Если мы в значение выбранного элемента передаем -1, то в списке не будет выбранного элемента.
2) Адаптер. Мы создаем ArrayAdapter, используя массив data и стандартный layout select_dialog_singlechoice, и передаем его в метод setSingleChoiceItems. Также передаем туда позицию выбранного элемента и обработчик.
3) Курсор БД. Вызываем метод setSingleChoiceItems. Передаем туда курсор, позицию выбранного элемента, имя поля (значение которого будет показано в списке) и обработчик нажатия.
Кроме списка указываем только заголовок. В конце добавим кнопку ОК, создаем и возвращаем Dialog.
Как видим для всех трех способов создания используются методы с одинаковым названием setSingleChoiceItems, но с разными аргументами на вход.

myClickListener – обработчик нажатия на пункты списка и на кнопку. Если было нажатие на кнопку (а значит - закрытие диалога), то в лог выводим информацию о выбранном элементе. Иначе (нажатие на пункт списка) – выводим позицию нажатого элемента. Если диалог содержит список с одиночным или множественным выбором, то нажатие на пункт списка не приводит к закрытию диалога. Но это можно без проблем реализовать программно.

В onDestroy закрываем подключение к БД.

Все сохраним и запустим. Вызовем какой-нибудь диалог.

Ничего не выбрано, т.к. мы указали -1 в методе setSingleChoiceItems.

Нажмем на пункт, он выделился

А в логе появился текст
which = 2

Если нажмем на ОК, то диалог закроется. А лог отобразит позицию выбранного элемента.
pos = 2

Если теперь снова откроете диалог, то выбранный пункт так и останется выбранным. Т.к. диалог не уничтожается при закрытии. Если хотите перед каждым вызовом менять выбранный элемент, реализуйте метод onPrepareDialog. В нем надо добраться до списка и вызвать метод setItemChecked.
Пример кода, в котором выбирается третий элемент (нумерация с нуля):



На следующем уроке:
- формируем список с множественным выбором в диалоге
Присоединяйтесь к нам в Telegram:
- в канале StartAndroid публикуются ссылки на новые статьи с сайта startandroid.ru и интересные материалы с хабра, medium.com и т.п.
- в чатах решаем возникающие вопросы и проблемы по различным темам: Android, Compose, Kotlin, RxJava, Dagger, Тестирование, Performance
- ну и если просто хочется поговорить с коллегами по разработке, то есть чат Флудильня
