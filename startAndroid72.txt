Урок 73. Preferences. Управляем активностью настроек (setEnabled)
26 апреля 2012
В этом уроке:
- управляем активностью настроек (setEnabled)

Иногда в настройках можно наблюдать, как некоторые из них неактивны - с ними нельзя взаимодействовать. Причем это зависит от смежных настроек. Т.е. выключили одну галку - стала  неактивна другая. Разберемся, как это делается.

Создадим проект:
Project name: P0731_PreferencesEnable Build Target: Android 2.3.3 Application name: PreferencesEnable Package name: ru.startandroid.develop.p0731preferencesenable Create Activity: MainActivity

Заполним strings.xml:
Это два массива для списка ListPreference.

Создадим xml файл настроек, res/xml/pref.xml:
Нас интересует атрибут dependency. В нем можно указать key какого-либо CheckBoxPreference - и по включению/выключения чекбокса будет активна/неактивна настройка. Т.е. например мы для ListPreference c key = list указали dependency = chb1. И теперь включая/выключая chb1 будет меняться активность list. Этот механизм работает с обычными настройками и с PreferenceScreen, а с PreferenceCategory – нет. Для категорий придется то же самое накодить.
Еще обратите внимание на атрибуты summaryOn и summaryOff у chb1. Это тексты-описания настройки, аналогично summary. Они отображаются в зависимости от того включен (summaryOn) чекбокс или выключен (summaryOff).

Создаем экран настроек, PrefActivity.java:
С помощью метода findPreference мы находим на экране чекбокс (chb3) и категорию (categ2). И методом setEnabled устанавливаем, что активность категории равна значению чекбокса (вкл/выкл). Это, чтобы при старте экрана все было верно.
Далее для чекбокса прописываем обработчик и в нем по нажатию устанавливаем связь - активность категории равна значению чекбокса.

В MainActivity.java только создаем пункт меню для перехода к настройкам:

Все сохраняем и запускаем приложение. Переходим к настройкам.

CheckBox 1 выключен, соответственно неактивен и List. Также CheckBox 2 выключен, неактивен Screen. Это мы прописывали в атрибутах dependency в pref.xml.
Включим CheckBox 1:

List теперь активен. И обратите внимание, что поменялось описание CheckBox 1. Пока чекбокс был выключен, отображался текст из атрибута summaryOff, а теперь он включен и мы видим текст из summaryOn.
Давайте включим CheckBox2.

Screen теперь активен.
Нажимаем на него и проваливаемся внутрь.

Напомню в коде мы прописывали, что Category 2 зависела от CheckBox 3. И действительно  – чекбокс выключен и категория не активна.
Включим чекбокс

Категория стала активна. Все ок.

На этом уроке немного посмотрели, как через код работать с экраном настроек. Думаю, имеет смысл рассмотреть это более подробно.

На следующем уроке:
- создаем экран настроек программно
Присоединяйтесь к нам в Telegram:
- в канале StartAndroid публикуются ссылки на новые статьи с сайта startandroid.ru и интересные материалы с хабра, medium.com и т.п.
- в чатах решаем возникающие вопросы и проблемы по различным темам: Android, Compose, Kotlin, RxJava, Dagger, Тестирование, Performance
- ну и если просто хочется поговорить с коллегами по разработке, то есть чат Флудильня
